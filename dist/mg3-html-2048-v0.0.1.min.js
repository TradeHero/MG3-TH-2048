/*! MG3-TH-2048 v0.0.1 2014-11-20 http://www.tradehero.mobi by TradeHero */
var GameAssets=function(){"use strict";var a={},b={name:"Classic",backgroundColor:"#bbada0",cellBackgroundColor:"rgba(238, 228, 218, 0.35)",tileBackgroundColor:{2:"#eee4da",4:"#ede0c8",8:"#f2b179",16:"#f59563",32:"#f67c5f",64:"#f65e3b",128:"#edcf72",256:"#edcc61",512:"#edc850",1024:"#edc53f",2048:"#edc22e"},tileTextColor:{2:"#776e65",4:"#776e65",8:"#f9f6f2",16:"#f9f6f2",32:"#f9f6f2",64:"#f9f6f2",128:"#f9f6f2",256:"#f9f6f2",512:"#f9f6f2",1024:"#f9f6f2",2048:"#f9f6f2"},stocksMapping:{2:"DATE",4:"CCIH",8:"TOUR",16:"SOHU",32:"WUBA",64:"CTRP",128:"NTES",256:"JD",512:"BIDU",1024:"BABA",2048:"AAPL"},score:{backgroundColor:"rgb(186, 173, 160)",titleColor:"rgb(237, 228, 218)",valueColor:"rgb(255, 255, 255)"},gameOver:{backgroundColor:"rgba(238, 228, 218, 0.5)",textColor:"#776e65"},gameWon:{backgroundColor:"rgba(237, 194, 46, 0.5)",textColor:"#f9f6f2"},restart:{backgroundColor:"rgb(143, 122, 102)",textColor:"rgb(255, 255, 255)"}};return{getStandardPackage:function(){return a},getClassicPackage:function(){return b}}}();!function(){"use strict";var a=function(){var a=function(){var a=document.createElement("canvas").getContext("2d"),b=window.devicePixelRatio||1,c=a.webkitBackingStorePixelRatio||a.mozBackingStorePixelRatio||a.msBackingStorePixelRatio||a.oBackingStorePixelRatio||a.backingStorePixelRatio||1;return b/c}(),b=document.getElementById("body"),c={createCanvas:function(a,b){{var c=this.getPixelRatio(),d=document.createElement("canvas");d.getContext("2d")}return d.width=a*c,d.height=b*c,d.style.width=a+"px",d.style.height=b+"px",d},getPixelRatio:function(){return a},getSize:function(){return Math.min(this.getWidth(),this.getHeight())},getSlideSpeed:function(){return this.getSize()/25*this.getPixelRatio()},getGrowthSpeed:function(){return this.getSize()/100*this.getPixelRatio()},getHeaderSize:function(){return Math.floor(this.getSize()/8.33)*this.getPixelRatio()},getResetSize:function(){return Math.floor(this.getSize()/30)*this.getPixelRatio()},getTileSize:function(a,b){return Math.floor(Math.min(a,b)/1.94)},getBorder:function(){return this.getSize()/40*this.getPixelRatio()},getWidth:function(){var a=document.documentElement;return window.innerWidth||a.clientWidth||b.clientWidth},getHeight:function(){var a=document.documentElement;return window.innerHeight||a.clientHeight||b.clientHeight},getCellWidth:function(a,b){return(a.width-c.getBorder()*(b.width+1))/b.width},getCellHeight:function(a,b){return(a.height-this.getBorder()*(b.height+1))/b.height}};return{createCanvas:function(a,b){return c.createCanvas(a,b)},getPixelRatio:function(){return c.getPixelRatio()},getSize:function(){return c.getSize()},getSlideSpeed:function(){return c.getSlideSpeed()},getGrowthSpeed:function(){return c.getGrowthSpeed()},getHeaderSize:function(){return c.getHeaderSize()},getResetSize:function(){return c.getResetSize()},getTileSize:function(a,b){return c.getTileSize(a,b)},getBorder:function(){return c.getBorder()},getWidth:function(){return c.getWidth()},getHeight:function(){return c.getHeight()},getCellWidth:function(a,b){return c.getCellWidth(a,b)},getCellHeight:function(a,b){return c.getCellHeight(a,b)}}}(),b=function(){var a,b={37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN"};addEventListener("keydown",function(c){b[c.keyCode]&&c.preventDefault(),a=b[c.keyCode]});var c={x:0,y:0};addEventListener("touchstart",function(a){a.preventDefault(),a.changedTouches=a.changedTouches||[{pageX:0,pageY:0}];var b=a.changedTouches[0];c.x=b.pageX,c.y=b.pageY}),addEventListener("touchend",function(b){b.preventDefault(),b.changedTouches=b.changedTouches||[{pageX:0,pageY:0}];var d=b.changedTouches[0],e=c.x-d.pageX,f=c.y-d.pageY;c.x=0,c.y=0,a=Math.abs(e)>Math.abs(f)?e>0?"LEFT":"RIGHT":f>0?"UP":"DOWN"});var d={getCommand:function(){var b=a;return a=void 0,b},resetClick:function(a){var b=function(c){c.preventDefault(),removeEventListener("click",b),removeEventListener("touchend",b),a()};addEventListener("click",b),addEventListener("touchend",b)}};return{getCommand:function(){return d.getCommand()},resetClick:function(a){d.resetClick(a)}}}(),c=function(){var b={animate:function(a,b,c){for(var d=!1,e=0;e<c.width;e++)for(var f=0;f<c.height;f++){var g=c.tiles[e][f],h=c.mergedTiles[e][f];g&&((g.triggerGrowth||g.growing)&&this.animateGrowth(a,b,g),(g.triggerSlide||g.sliding)&&(this.animateSliding(a,b,g),d=!0)),h&&(h.triggerSlide||h.sliding)&&(this.animateSliding(a,b,h),d=!0)}return d},animateGrowth:function(b,c,d){var e={GROW:"GROW",SHRINK:"SHRINK"},f=a.getGrowthSpeed();void 0===d.growing?d.growing={modifier:e.GROW,value:f,maxSize:15,minSize:0}:d.growing.modifier===e.GROW?(d.growing.value+=f,d.growing.value>=d.growing.maxSize&&(d.growing.modifier=e.SHRINK)):d.growing.modifier===e.SHRINK&&(d.growing.value-=f,d.growing.value<=d.growing.minSize&&(delete d.triggerGrowth,delete d.growing))},animateSliding:function(b,c,d){var e=a.getSlideSpeed();if(void 0===d.sliding)d.sliding={value:0};else{var f=d.slidingData;switch(f.direction){case"UP":case"DOWN":e+=Math.abs(f.startY-f.endY)*e;break;case"LEFT":case"RIGHT":e+=Math.abs(f.startX-f.endX)*e}d.sliding.value+=e}}};return{animate:function(a,c,d){return b.animate(a,c,d)}}}(),d=function(){var b=GameAssets.getClassicPackage(),c={render:function(c,d,e){d.fillStyle=b.backgroundColor,d.fillRect(0,0,c.width,c.height);var f=a.getCellHeight(c,e),g=a.getCellWidth(c,e);this.drawCells(d,e,g,f),this.drawMergedTiles(d,e,g,f),this.drawTiles(d,e,g,f)},renderScores:function(a,b,c,d){var e=this.drawTopScore(a,b,d);this.drawCurrentScore(a,b,e,c)},showGameOver:function(c,d){this.showOverlay(c,d,b.gameOver.backgroundColor),d.font="bold "+a.getHeaderSize()+"px Helvetica Neue",d.textAlign="center",d.textBaseline="middle",d.fillStyle=b.gameOver.textColor,d.fillText("Game Over!",c.width/2,c.height/2,c.width),this.showRestart(c,d)},showGameWon:function(c,d){this.showOverlay(c,d,b.gameWon.backgroundColor),d.font="bold "+a.getHeaderSize()+"px Helvetica Neue",d.textAlign="center",d.textBaseline="middle",d.fillStyle=b.gameWon.textColor,d.fillText("You win!",c.width/2,c.height/2,c.width),this.showRestart(c,d)},roundedRectangle:function(a,b,c,d,e,f){a.beginPath(),a.moveTo(b+f,c),a.lineTo(b+d-f,c),a.quadraticCurveTo(b+d,c,b+d,c+f),a.lineTo(b+d,c+e-f),a.quadraticCurveTo(b+d,c+e,b+d-f,c+e),a.lineTo(b+f,c+e),a.quadraticCurveTo(b,c+e,b,c+e-f),a.lineTo(b,c+f),a.quadraticCurveTo(b,c,b+f,c),a.fill(),a.closePath()},showOverlay:function(a,b,c){b.fillStyle=c,b.fillRect(0,0,a.width,a.height)},showRestart:function(c,d){var e=a.getResetSize(),f=Math.floor(6.67*e),g=Math.floor(f/2.5),h=Math.floor(f/10),i=c.width/2-f/2,j=c.height/2+50;d.fillStyle=b.restart.backgroundColor,this.roundedRectangle(d,i,j,f,g,4),d.font="bold "+e+"px Helvetica Neue",d.textAlign="center",d.textAlign="middle",d.fillStyle=b.restart.textColor,d.fillText("Play Again?",i+f/2,j+g/2,f-2*h)},drawCells:function(a,b,c,d){for(var e=0;e<b.width;e++)for(var f=0;f<b.height;f++){var g=this.getCellCoordinates(b,c,d,e,f);this.drawCell(a,g,c,d)}},drawCell:function(a,c,d,e){a.fillStyle=b.cellBackgroundColor,this.roundedRectangle(a,c.x,c.y,d,e,5)},drawTiles:function(a,b,c,d){for(var e=0;e<b.width;e++)for(var f=0;f<b.height;f++)if(b.tiles[e][f]){var g=this.getCellCoordinates(b,c,d,e,f);this.drawTile(a,b,b.tiles[e][f],g,c,d)}},drawTile:function(c,d,e,f,g,h){var i=f.x,j=f.y;if(e.sliding){var k=e.slidingData.direction,l=e.sliding.value,m=this.getCellCoordinates(d,g,h,e.slidingData.startX,e.slidingData.startY),n=this.getCellCoordinates(d,g,h,e.slidingData.endX,e.slidingData.endY);"UP"===k?(j=m.y-l,j=j<=n.y?n.y:j):"DOWN"===k?(j=m.y+l,j=j>=n.y?n.y:j):"LEFT"===k?(i=m.x-l,i=i<=n.x?n.x:i):"RIGHT"===k&&(i=m.x+l,i=i>=n.x?n.x:i),("UP"===k&&j<=n.y||"DOWN"===k&&j>=n.y||"LEFT"===k&&i<=n.x||"RIGHT"===k&&i>=n.x)&&(delete e.sliding,delete e.slidingData,delete e.triggerSlide)}if(e.growing){var o=e.growing&&!e.sliding?e.growing.value:0;i-=o/2,j-=o/2,g+=o,h+=o}c.fillStyle=b.tileBackgroundColor[e.value],this.roundedRectangle(c,i,j,g,h,5);var p=i+g/2,q=j+h/2;c.font="bold "+a.getTileSize(g,h)/1.5+"px Helvetica Neue",c.textAlign="center",c.textBaseline="middle",c.fillStyle=b.tileTextColor[e.value],c.fillText(b.stocksMapping[e.value],p,q,g-10)},drawMergedTiles:function(a,b,c,d){for(var e=0;e<b.width;e++)for(var f=0;f<b.height;f++)if(b.mergedTiles[e][f]){var g=b.mergedTiles[e][f],h=this.getCellCoordinates(b,c,d,g.slidingData.endX,g.slidingData.endY);this.drawTile(a,b,g,h,c,d),g.sliding||(b.mergedTiles[e][f]=void 0)}},getCellCoordinates:function(b,c,d,e,f){return e=parseInt(e,10),f=parseInt(f,10),{x:e*c+(e+1)*a.getBorder(),y:f*d+(f+1)*a.getBorder()}},drawCurrentScore:function(a,c,d,e){var f=10,g=180,h=a.height-2*f,i=d.x-(g+f),j=f;return c.fillStyle=b.score.backgroundColor,this.roundedRectangle(c,i,j,g,h,4),c.fillStyle=b.score.titleColor,c.font="bold 24px Helvetica Neue",c.textAlign="center",c.textBaseline="top",c.fillText("Score:",i+g/2,j+5,g),c.fillStyle=b.score.valueColor,c.font="bold 36px Helvetica Neue",c.textBaseline="bottom",c.fillText(e,i+g/2,j+h-5,g),{x:0,y:0}},drawTopScore:function(a,c,d){var e=10,f=180,g=a.height-2*e,h=a.width-f,i=e;return c.fillStyle=b.score.backgroundColor,this.roundedRectangle(c,h,i,f,g,4),c.fillStyle=b.score.titleColor,c.font="bold 24px Helvetica Neue",c.textAlign="center",c.textBaseline="top",c.fillText("Top Score:",h+f/2,i+5,f),c.fillStyle=b.score.valueColor,c.font="bold 36px Helvetica Neue",c.textBaseline="bottom",c.fillText(d,h+f/2,i+g-5,f),{x:h,y:i}}};return{render:function(a,b,d){return c.render(a,b,d)},renderScores:function(a,b,d,e){return c.renderScores(a,b,d,e)},showGameOver:function(a,b){c.showGameOver(a,b)},showGameWon:function(a,b){c.showGameWon(a,b)}}}(),e=function(){var a={move:function(a,b){if(a){var c=function(){};switch(a){case"UP":c=this.moveUp;break;case"DOWN":c=this.moveDown;break;case"LEFT":c=this.moveLeft;break;case"RIGHT":c=this.moveRight}return c(b)}return!1},canMove:function(a,b){switch(a){case"UP":return this.canMoveUp(b);case"DOWN":return this.canMoveDown(b);case"LEFT":return this.canMoveLeft(b);case"RIGHT":return this.canMoveRight(b)}return!1},canMoveUp:function(a){for(var b=0;b<a.width;b++)for(var c=1;c<a.height;c++)if(a.tiles[b][c]){if(!a.tiles[b][c-1])return!0;if(a.tiles[b][c].value===a.tiles[b][c-1].value)return!0}return!1},canMoveDown:function(a){for(var b=0;b<a.width;b++)for(var c=0;c<a.height-1;c++)if(a.tiles[b][c]){if(!a.tiles[b][c+1])return!0;if(a.tiles[b][c].value===a.tiles[b][c+1].value)return!0}return!1},canMoveLeft:function(a){for(var b=1;b<a.width;b++)for(var c=0;c<a.height;c++)if(a.tiles[b][c]){if(!a.tiles[b-1][c])return!0;if(a.tiles[b][c].value===a.tiles[b-1][c].value)return!0}return!1},canMoveRight:function(a){for(var b=0;b<a.width-1;b++)for(var c=0;c<a.height;c++)if(a.tiles[b][c]){if(!a.tiles[b+1][c])return!0;if(a.tiles[b][c].value===a.tiles[b+1][c].value)return!0}return!1},moveUp:function(){var b=function(a,b){return a.reduceRight(function(a,c,d){return b>=d&&!c?d:a},b)},c=function(a,b){return a.reduce(function(a,c,d){return b>=d?void 0:!a&&c?d:a},void 0)};return function(d){if(a.canMoveUp(d)){for(var e={score:0},f=0;f<d.width;f++)for(var g=0;g<d.height;g++)if(d.tiles[f][g]){var h=d.tiles[f][g],i=b(d.tiles[f],g),j=c(d.tiles[f],g);a.attemptMove(d,"UP",f,g,f,i);var k=a.attemptMerge(d,"UP",f,h.y,f,j);k&&isFinite(k.score)&&(e.score+=k.score)}return e}return!1}}(),moveDown:function(){var b=function(a,b){return a.reduce(function(a,c,d){return d>=b&&!c?d:a},b)},c=function(a,b){return a.reduceRight(function(a,c,d){return d>=b?void 0:!a&&c?d:a},void 0)};return function(d){if(a.canMoveDown(d)){for(var e={score:0},f=0;f<d.width;f++)for(var g=d.height-1;g>=0;g--)if(d.tiles[f][g]){var h=d.tiles[f][g],i=b(d.tiles[f],g),j=c(d.tiles[f],g);a.attemptMove(d,"DOWN",f,g,f,i);var k=a.attemptMerge(d,"DOWN",f,h.y,f,j);k&&isFinite(k.score)&&(e.score+=k.score)}return e}return!1}}(),moveLeft:function(){var b=function(a,b,c){return a.tiles.reduceRight(function(a,d,e){return b>=e&&!d[c]?e:a},b)},c=function(a,b,c){return a.tiles.reduce(function(a,d,e){return b>=e?void 0:!a&&d[c]?e:a},void 0)};return function(d){if(a.canMoveLeft(d)){for(var e={score:0},f=0;f<d.height;f++)for(var g=0;g<d.width;g++)if(d.tiles[g][f]){var h=d.tiles[g][f],i=b(d,g,f),j=c(d,g,f);a.attemptMove(d,"LEFT",g,f,i,f);var k=a.attemptMerge(d,"LEFT",h.x,f,j,f);k&&isFinite(k.score)&&(e.score+=k.score)}return e}return!1}}(),moveRight:function(){var b=function(a,b,c){return a.tiles.reduce(function(a,d,e){return e>=b&&!d[c]?e:a},b)},c=function(a,b,c){return a.tiles.reduceRight(function(a,d,e){return e>=b?void 0:!a&&d[c]?e:a},void 0)};return function(d){if(a.canMoveRight(d)){for(var e={score:0},f=0;f<d.height;f++)for(var g=d.width-1;g>=0;g--)if(d.tiles[g][f]){var h=d.tiles[g][f],i=b(d,g,f),j=c(d,g,f);a.attemptMove(d,"RIGHT",g,f,i,f);var k=a.attemptMerge(d,"RIGHT",h.x,f,j,f);k&&isFinite(k.score)&&(e.score+=k.score)}return e}return!1}}(),setupSlide:function(a,b,c,d,e,f){var g=a.tiles[c][d];g.sliding={value:0},g.triggerSlide=!0,g.slidingData={direction:b,startX:c,startY:d,endX:e,endY:f}},attemptMove:function(a,b,c,d,e,f){if(isFinite(c)&&isFinite(d)&&isFinite(e)&&isFinite(f)&&(c!==e||d!==f)){var g=a.tiles[c][d];return g.x=e,g.y=f,this.setupSlide(a,b,c,d,e,f),a.tiles[e][f]=g,a.tiles[c][d]=void 0,!0}return!1},attemptMerge:function(a,b,c,d,e,f){return isFinite(c)&&isFinite(d)&&isFinite(e)&&isFinite(f)&&a.tiles[c][d].value===a.tiles[e][f].value?(a.tiles[c][d].value*=2,a.tiles[c][d].triggerGrowth=!0,this.setupSlide(a,b,e,f,c,d),a.mergedTiles[e][f]=a.tiles[e][f],a.tiles[e][f]=void 0,{score:a.tiles[c][d].value}):!1}};return{move:function(b,c){return a.move(b,c)},canMove:function(b,c){return a.canMove(b,c)}}}(),f=function(){var a={reset:function(){for(var a={tiles:[],mergedTiles:[],width:4,height:4,winningValue:2048},b=0;b<a.width;b++){a.tiles[b]=[],a.mergedTiles[b]=[];for(var c=0;c<a.height;c++)a.tiles[b][c]=void 0,a.mergedTiles[b][c]=void 0}var d=h(a);a.tiles[d.x][d.y]=d;var e=h(a);return a.tiles[e.x][e.y]=e,a},hasLost:function(a){return!(e.canMove("UP",a)||e.canMove("DOWN",a)||e.canMove("LEFT",a)||e.canMove("RIGHT",a))},hasWon:function(a){for(var b=0;b<a.width;b++)for(var c=0;c<a.height;c++)if(a.tiles[b][c]&&a.tiles[b][c].value===a.winningValue)return!0;return!1}};return{reset:function(){return a.reset()},hasLost:function(b){return a.hasLost(b)},hasWon:function(b){return a.hasWon(b)}}}(),g=function(a){for(var b={},c=0;c<a.width;c++){for(var d=[],e=0;e<a.height;e++)a.tiles[c][e]||d.push(e);d.length>0&&(b[c]=d)}return b},h=function(a){var b=g(a),c=[];for(var d in b)c.push(d);var e=c[Math.floor(Math.random()*c.length)],f=Math.floor(Math.random()*b[e].length);return{value:2*Math.ceil(2*Math.random()),x:e,y:b[e][f],triggerGrowth:!0,growing:{modifier:"GROW",value:-25,maxSize:0,minSize:0}}};window.Application=function(){var g,i,j,k;!function(){var b=100/a.getPixelRatio(),c=a.getSize();c=a.getHeight()-b<=a.getWidth()?a.getHeight()-b:c,j=a.createCanvas(c,b),k=j.getContext("2d"),g=a.createCanvas(c,c),i=g.getContext("2d");var d=document.getElementById("body");d.appendChild(j),d.appendChild(g)}();var l={grid:f.reset(),data:{score:0,topScore:0,insertTile:!1,allowResetCallback:!0}},m=function(){l.data.score=0,l.data.allowResetCallback=!0,l.data.insertTile=!1,l.grid=f.reset()},n=[];!function p(){var a=c.animate(g,i,l.grid);d.render(g,i,l.grid),d.renderScores(j,k,l.data.score,l.data.topScore);var o=f.hasWon(l.grid),q=f.hasLost(l.grid);if(o||q){if(l.data.allowResetCallback){b.resetClick(m);for(var r=0;r<n.length;r++){var s=n[r];s.callback.call(s.context,l.data.topScore)}l.data.allowResetCallback=!1}o?d.showGameWon(g,i):d.showGameOver(g,i)}else if(!a)if(l.data.insertTile){l.data.insertTile=!1;var t=h(l.grid);l.grid.tiles[t.x][t.y]=t}else{var u=e.move(b.getCommand(),l.grid);u&&(l.data.score+=u.score,l.data.insertTile=!0,l.data.score>l.data.topScore&&(l.data.topScore=l.data.score))}setTimeout(p,25)}();var o={restart:function(){m()},save:function(){return JSON.stringify(l)},resume:function(a){l=JSON.parse(a)},onGameFinished:function(a,b){n.push({callback:a,context:b})}};return{restart:function(){return o.restart()},save:function(){return o.save()},resume:function(a){return o.resume(a)},onGameFinished:function(a,b){return o.onGameFinished(a,b)}}}()}();